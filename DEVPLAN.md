# XJTU Toolbox 开发计划

> 上次更新：2025-07

---

## 已完成 ✅

### v1.2.1 (正式版)
- [x] RSA 公钥解析修复（X.509/PKCS#1 双格式 + 缓存重试机制）
- [x] 教材查询完整重写（POST + JS 自动提交表单 + FineReport 错误解码）
- [x] 离线路由系统：成绩查询支持缓存离线、空闲教室和通知公告断网拦截
- [x] 课表离线缓存回退（学期列表 + 课程 + 考试）
- [x] JSON 安全解析（44 处替换）、DataCache 完整重写
- [x] Room 数据库迁移安全、Bitmap OOM 防御
- [x] 图书馆抢座修复：`dataSync` → `shortService`、等待阈值放宽、失败通知
- [x] CookieJar 修复、并行登录、SWR 缓存策略
- [x] 3 轮 UX/UI 优化（35 项/16+ 文件）、GPA 卡片 v3
- [x] 自定义课程 + Room DB、ICS/CSV/图片导出 + FileProvider
- [x] 欢迎卡片 3 态、通用断网检测、Profile 加载态
- [x] 付款码崩溃修复、双击返回退出
- [x] ProGuard 调试日志移除、备份排除配置
- [x] 全审计 HIGH/MEDIUM 问题修复、18/22 优化项实施

### v1.1-beta
- [x] 15 项深度优化（登录加速、缓存、连接池、状态持久化、ViewModel 迁移等）
- [x] 缓存安全机制（课表更新 Snackbar、考试仅缓存旧学期、离线提示、TTL 控制）
- [x] 成绩页 SWR 缓存 + 进度指示器 + 新成绩提醒
- [x] 课表时间线指示器（当前周红线标注当前时间）
- [x] 校园卡入口提至所有页面首位
- [x] 图书馆定时抢座（AlarmManager + ForegroundService、认证预热、通知推送、进程保活提醒）

---

## 进行中 🚧

### 推送通知系统
**描述**：后台定期检查各系统状态变更，推送提醒。

**计划子功能**：
1. **考勤异常推送** — WorkManager 定期轮询，检测到旷课/迟到/缺勤时推送通知
2. **新成绩推送** — 后台比对成绩缓存，出新成绩时推送
3. **图书到期提醒** — 到期前 3 天提醒，支持一键续借

**技术方案**：
- WorkManager 定期任务（可配置间隔）
- 各系统 Login + API 获取数据 → 与本地缓存对比
- NotificationCompat 推送 + 通知渠道分组
- 用户可设置提醒频率、免打扰时段

### 图书馆抢座增强
**描述**：提升抢座成功率和用户体验。

**计划改进**：
1. **国产 ROM 自启动引导** — 检测手机品牌，引导用户到对应自启动/电池优化设置页
2. **测试闹钟功能** — 一键设定 30 秒后的测试闹钟验证整条链路
3. **抢座失败恢复机制** — 服务崩溃或异常中断时自动重新调度
4. **areaCode 校验** — 防止空区域码导致请求静默失败

---

## 待开发 🔧

### P2 — 图书借阅管理
**描述**：查看当前借阅列表、到期提醒、续借操作。

**技术方案**：
- 对接图书馆借阅管理系统（www.lib.xjtu.edu.cn 或 OPAC）
- 解析借阅列表页面（HTML → 数据模型）
- 到期前 3 天 WorkManager 推送提醒
- 一键续借功能
- UI：借阅卡片列表 + 到期倒计时 + 续借按钮

**预期工作量**：3-5 天

---

## 备忘

- 任何编译操作需经用户明确许可
- Git proxy: `http://127.0.0.1:7890`
- JAVA_HOME: `C:\Program Files\Android\Android Studio\jbr`
